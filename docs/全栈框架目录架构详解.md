# 全栈框架目录架构详解

## 目录

- [概述](#概述)
- [项目根目录结构](#项目根目录结构)
- [后端目录结构详解](#后端目录结构详解)
- [前端目录结构详解](#前端目录结构详解)
- [配置文件说明](#配置文件说明)
- [目录组织原则](#目录组织原则)
- [开发工作流](#开发工作流)

---

## 概述

本文档详细解释全栈框架的目录架构，帮助你理解每个目录和文件的作用，以及它们如何组织在一起。

### 架构特点

- **前后端分离**：前端和后端完全分离，可以独立开发和部署
- **模块化设计**：代码按功能模块组织，便于维护和扩展
- **分层架构**：采用分层架构，职责清晰
- **配置分离**：配置文件独立管理，便于不同环境部署

---

## 项目根目录结构

```
full-stack-fastapi-template/
├── .copier/                    # Copier 模板配置（项目生成工具）
├── .github/                    # GitHub 配置
│   ├── workflows/              # GitHub Actions 工作流
│   ├── ISSUE_TEMPLATE/        # Issue 模板
│   └── ...
├── backend/                    # 后端代码（Python/FastAPI）
├── frontend/                   # 前端代码（React/TypeScript）
├── docs/                       # 项目文档
├── hooks/                      # 项目生成钩子脚本
├── img/                        # 项目图片资源
├── scripts/                    # 项目级脚本
├── docker-compose.yml          # Docker Compose 配置
├── docker-compose.override.yml # Docker Compose 开发环境覆盖配置
├── docker-compose.traefik.yml # Traefik 反向代理配置
├── .env                        # 环境变量（本地开发，不提交到 Git）
├── env.example                 # 环境变量示例文件
├── .gitignore                  # Git 忽略文件配置
├── .pre-commit-config.yaml     # Pre-commit 钩子配置
├── README.md                   # 项目说明文档
├── LICENSE                     # 许可证文件
└── SECURITY.md                 # 安全策略文档
```

### 根目录文件说明

| 文件/目录 | 作用 | 说明 |
|----------|------|------|
| `backend/` | 后端代码 | Python/FastAPI 后端应用 |
| `frontend/` | 前端代码 | React/TypeScript 前端应用 |
| `docs/` | 项目文档 | 技术文档、开发日志等 |
| `docker-compose.yml` | Docker 编排 | 定义所有服务（数据库、Redis、后端、前端等） |
| `docker-compose.override.yml` | 开发环境覆盖 | 开发时的额外配置 |
| `docker-compose.traefik.yml` | Traefik 配置 | 反向代理和 HTTPS 配置 |
| `.env` | 环境变量 | 本地开发环境变量（不提交到 Git） |
| `env.example` | 环境变量示例 | 环境变量模板，供参考 |
| `.gitignore` | Git 忽略规则 | 定义不提交到 Git 的文件 |
| `.pre-commit-config.yaml` | Pre-commit 配置 | 代码提交前的检查配置 |
| `scripts/` | 项目脚本 | 构建、部署、测试等脚本 |

---

## 后端目录结构详解

```
backend/
├── app/                        # 应用主目录
│   ├── __init__.py            # Python 包标识
│   ├── main.py                # FastAPI 应用入口
│   ├── admin/                 # 管理后台配置
│   ├── alembic/               # 数据库迁移文件
│   ├── api/                   # API 路由和依赖
│   ├── core/                  # 核心配置和工具
│   ├── crud/                  # 数据库 CRUD 操作
│   ├── email-templates/       # 邮件模板
│   ├── exceptions/            # 异常处理
│   ├── locales/               # 国际化翻译文件
│   ├── middleware/            # 中间件
│   ├── models/                # 数据模型（SQLModel）
│   ├── schemas/                # Pydantic 数据模式
│   ├── services/              # 业务逻辑服务层
│   ├── users/                 # 用户相关配置
│   └── utils/                 # 工具函数
├── scripts/                    # 后端脚本
├── tests/                      # 测试文件
├── Dockerfile                 # 后端 Docker 镜像构建文件
├── pyproject.toml             # Python 项目配置和依赖
├── alembic.ini                # Alembic 数据库迁移配置
├── uv.lock                    # UV 依赖锁定文件
└── README.md                  # 后端说明文档
```

### 后端核心目录详解

#### 1. `app/` - 应用主目录

这是后端应用的核心目录，包含所有应用代码。

##### `app/main.py` - 应用入口

**作用**：FastAPI 应用的入口文件，初始化应用、中间件、路由等。

**主要功能**：
- 创建 FastAPI 应用实例
- 配置中间件（CORS、Session、限流等）
- 注册 API 路由
- 初始化缓存、国际化、权限系统
- 配置管理后台
- 设置异常处理器

##### `app/admin/` - 管理后台

**作用**：配置 SQLAdmin 管理后台。

**文件说明**：
- `__init__.py`：导出管理后台配置
- `auth.py`：管理后台认证配置
- `config.py`：管理后台界面配置

**功能**：
- 提供 Web 界面管理数据库
- 用户管理、权限管理
- 数据查看和编辑

##### `app/alembic/` - 数据库迁移

**作用**：Alembic 数据库迁移工具配置和迁移脚本。

**文件说明**：
- `env.py`：Alembic 环境配置
- `script.py.mako`：迁移脚本模板
- `versions/`：迁移脚本目录
  - `*.py`：具体的迁移脚本文件

**功能**：
- 数据库版本管理
- 自动生成迁移脚本
- 数据库结构变更追踪

##### `app/api/` - API 路由

**作用**：定义所有 API 路由和依赖。

**文件说明**：
- `main.py`：API 路由主文件，汇总所有路由
- `deps.py`：通用依赖（如获取当前用户）
- `deps_i18n.py`：国际化依赖
- `deps_permissions.py`：权限依赖
- `deps_rate_limit.py`：限流依赖
- `routes/`：具体路由文件
  - `auth.py`：认证相关路由（登录、注册、重置密码等）
  - `users.py`：用户管理路由
  - `items.py`：项目/物品管理路由
  - `files.py`：文件上传下载路由
  - `private.py`：私有接口路由
  - `utils.py`：工具接口路由（健康检查等）

**架构模式**：
- **路由层**：处理 HTTP 请求和响应
- **依赖注入**：使用 FastAPI 的依赖注入系统
- **权限控制**：通过依赖注入实现权限检查

##### `app/core/` - 核心配置

**作用**：应用的核心配置和初始化代码。

**文件说明**：
- `config.py`：应用配置（使用 Pydantic Settings）
  - 数据库配置
  - Redis 配置
  - JWT 配置
  - 邮件配置
  - 缓存配置
  - 限流配置
  - 国际化配置
- `db.py`：数据库连接和初始化
  - SQLModel 引擎创建
  - 数据库初始化
  - 创建超级用户
- `security.py`：安全相关工具
  - 密码哈希和验证
  - JWT Token 生成和验证
- `cache.py`：缓存配置
  - Redis 缓存后端
  - 缓存装饰器
- `rate_limit.py`：限流配置
  - 限流器初始化
  - 限流策略配置
- `permissions.py`：权限系统配置
  - 权限检查逻辑
  - 用户权限获取
- `i18n.py`：国际化配置
  - 翻译初始化
  - 语言检测
- `logging_config.py`：日志配置
  - 日志格式
  - 日志级别

**设计原则**：
- **配置集中管理**：所有配置在 `config.py` 中
- **环境变量驱动**：通过环境变量配置
- **类型安全**：使用 Pydantic 验证配置

##### `app/models/` - 数据模型

**作用**：定义数据库模型（使用 SQLModel）。

**文件说明**：
- `common.py`：通用模型（如时间戳基类）
- `user.py`：用户模型
- `item.py`：项目/物品模型
- `file.py`：文件模型

**特点**：
- 使用 SQLModel（结合 SQLAlchemy 和 Pydantic）
- 支持类型提示
- 自动生成数据库表结构
- 支持关系映射（一对多、多对多等）

##### `app/schemas/` - 数据模式

**作用**：定义 Pydantic 数据验证模式。

**文件说明**：
- `response.py`：通用响应模式
- 其他模式通常在路由文件中定义

**功能**：
- 请求数据验证
- 响应数据序列化
- 自动生成 OpenAPI 文档

##### `app/crud/` - 数据库操作

**作用**：封装数据库 CRUD 操作。

**文件说明**：
- `user.py`：用户 CRUD 操作
- `item.py`：项目/物品 CRUD 操作
- `file.py`：文件 CRUD 操作

**设计模式**：
- **Repository 模式**：封装数据库操作
- **分离关注点**：路由层不直接操作数据库

##### `app/services/` - 业务逻辑

**作用**：业务逻辑服务层。

**文件说明**：
- `auth_service.py`：认证服务
- `user_service.py`：用户服务
- `item_service.py`：项目/物品服务
- `file_service.py`：文件服务

**功能**：
- 封装复杂业务逻辑
- 协调多个 CRUD 操作
- 处理业务规则

##### `app/middleware/` - 中间件

**作用**：自定义中间件。

**文件说明**：
- `request_id.py`：请求 ID 中间件（用于日志追踪）
- `setup.py`：中间件设置

**功能**：
- 请求处理前/后的逻辑
- 日志记录
- 请求追踪

##### `app/exceptions/` - 异常处理

**作用**：自定义异常和异常处理器。

**文件说明**：
- `custom.py`：自定义异常类
- `handlers.py`：异常处理器

**功能**：
- 统一异常处理
- 自定义错误响应
- 错误日志记录

##### `app/utils/` - 工具函数

**作用**：通用工具函数。

**文件说明**：
- `email.py`：邮件发送工具
- `files.py`：文件处理工具
- `i18n.py`：国际化工具
- `token.py`：Token 处理工具

##### `app/email-templates/` - 邮件模板

**作用**：邮件模板文件。

**文件说明**：
- `src/`：MJML 源文件（`.mjml`）
  - `new_account.mjml`：新账户邮件模板
  - `reset_password.mjml`：重置密码邮件模板
  - `test_email.mjml`：测试邮件模板
- `build/`：编译后的 HTML 文件（`.html`）

**工作流**：
1. 编写 MJML 模板（更易维护）
2. 编译成 HTML
3. 在代码中使用 HTML 模板

##### `app/locales/` - 国际化

**作用**：国际化翻译文件。

**文件说明**：
- `en_US/LC_MESSAGES/messages.po`：英文翻译
- `zh_CN/LC_MESSAGES/messages.po`：中文翻译

**功能**：
- 后端 API 的多语言支持
- 使用 gettext 标准格式

##### `app/users/` - 用户配置

**作用**：fastapi-users 相关配置。

**文件说明**：
- `config.py`：fastapi-users 配置

**功能**：
- 用户认证配置
- 用户管理配置

#### 2. `scripts/` - 后端脚本

**作用**：后端开发和部署脚本。

**文件说明**：
- `prestart.sh`：启动前脚本（数据库迁移、初始化等）
- `backend_pre_start.py`：启动前 Python 脚本
- `initial_data.py`：初始化数据脚本（创建超级用户等）
- `update_database.py`：更新数据库脚本
- `reset_db.py`：重置数据库脚本
- `compile_i18n.py`：编译国际化文件脚本
- `tests_pre_start.py`：测试前准备脚本
- `tests-start.sh`：测试启动脚本
- `format.sh`：代码格式化脚本
- `lint.sh`：代码检查脚本
- `test.sh`：测试脚本

#### 3. `tests/` - 测试文件

**作用**：后端测试代码。

**文件说明**：
- `conftest.py`：Pytest 配置和 fixtures
- `api/routes/`：API 路由测试
  - `test_auth.py`：认证测试
  - `test_users.py`：用户测试
  - `test_items.py`：项目/物品测试
  - `test_files.py`：文件测试
  - `test_private.py`：私有接口测试
  - `test_rate_limit.py`：限流测试
  - `test_i18n.py`：国际化测试
- `crud/`：CRUD 操作测试
- `scripts/`：脚本测试
- `utils/`：工具函数测试

**测试框架**：
- **Pytest**：Python 测试框架
- **HTTPX**：异步 HTTP 客户端（用于测试 API）

#### 4. 配置文件

##### `pyproject.toml`

**作用**：Python 项目配置和依赖管理。

**内容**：
- 项目元数据（名称、版本、描述等）
- 依赖包列表
- 开发依赖
- 构建配置
- 工具配置（Ruff、MyPy 等）

##### `alembic.ini`

**作用**：Alembic 数据库迁移工具配置。

**内容**：
- 数据库连接配置
- 迁移脚本路径
- 日志配置

##### `Dockerfile`

**作用**：后端 Docker 镜像构建文件。

**内容**：
- 基础镜像（Python）
- 依赖安装
- 应用代码复制
- 启动命令

---

## 前端目录结构详解

```
frontend/
├── src/                        # 源代码目录
│   ├── main.tsx               # 应用入口文件
│   ├── index.css              # 全局样式
│   ├── routes/                # 路由定义（TanStack Router）
│   ├── components/            # React 组件
│   ├── hooks/                 # 自定义 Hooks
│   ├── client/                # API 客户端（自动生成）
│   ├── i18n/                  # 国际化配置
│   ├── lib/                   # 工具库
│   └── utils.ts               # 工具函数
├── public/                     # 静态资源
├── tests/                      # 测试文件
├── Dockerfile                 # 前端 Docker 镜像构建文件
├── Dockerfile.playwright      # Playwright 测试 Docker 镜像
├── package.json               # 前端依赖和脚本
├── package-lock.json          # 依赖锁定文件
├── tsconfig.json              # TypeScript 配置
├── vite.config.ts             # Vite 构建配置
├── biome.json                 # Biome 代码检查配置
├── components.json            # shadcn/ui 组件配置
├── playwright.config.ts       # Playwright 测试配置
├── openapi-ts.config.ts       # OpenAPI TypeScript 生成配置
├── nginx.conf                 # Nginx 生产环境配置
├── nginx-backend-not-found.conf # Nginx 后端 404 配置
└── README.md                  # 前端说明文档
```

### 前端核心目录详解

#### 1. `src/` - 源代码目录

##### `src/main.tsx` - 应用入口

**作用**：React 应用的入口文件，初始化应用。

**主要功能**：
- 初始化 React 应用
- 配置 TanStack Router（路由）
- 配置 TanStack Query（数据获取）
- 配置国际化（i18next）
- 配置主题（暗色模式）
- 配置 API 客户端（OpenAPI）
- 全局错误处理

##### `src/routes/` - 路由定义

**作用**：使用 TanStack Router 定义路由。

**文件说明**：
- `__root.tsx`：根路由（应用布局）
- `_layout.tsx`：布局路由（需要认证的页面）
- `_layout/`：布局下的子路由
  - `index.tsx`：首页（仪表板）
  - `admin.tsx`：管理页面
  - `items.tsx`：项目/物品页面
  - `settings.tsx`：设置页面
- `login.tsx`：登录页面
- `signup.tsx`：注册页面
- `recover-password.tsx`：找回密码页面
- `reset-password.tsx`：重置密码页面
- `routeTree.gen.ts`：自动生成的路由树（不要手动编辑）

**特点**：
- **文件系统路由**：路由基于文件结构
- **类型安全**：TypeScript 类型支持
- **自动生成**：路由树自动生成

##### `src/components/` - React 组件

**作用**：所有 React 组件。

**目录结构**：
```
components/
├── ui/                        # shadcn/ui 基础组件
│   ├── button.tsx            # 按钮组件
│   ├── input.tsx             # 输入框组件
│   ├── form.tsx              # 表单组件
│   ├── table.tsx             # 表格组件
│   ├── dialog.tsx            # 对话框组件
│   └── ...
├── Common/                    # 通用组件
│   ├── AuthLayout.tsx        # 认证页面布局
│   ├── DataTable.tsx          # 数据表格组件
│   ├── Footer.tsx             # 页脚组件
│   ├── Logo.tsx               # Logo 组件
│   ├── NotFound.tsx           # 404 页面
│   ├── ErrorComponent.tsx    # 错误组件
│   ├── LanguageSwitcher.tsx  # 语言切换器
│   └── Appearance.tsx         # 主题切换器
├── Sidebar/                   # 侧边栏组件
│   ├── AppSidebar.tsx        # 侧边栏主组件
│   ├── Main.tsx              # 侧边栏主菜单
│   └── User.tsx              # 侧边栏用户信息
├── Admin/                     # 管理页面组件
│   ├── AddUser.tsx           # 添加用户
│   ├── EditUser.tsx          # 编辑用户
│   ├── DeleteUser.tsx        # 删除用户
│   ├── UserActionsMenu.tsx   # 用户操作菜单
│   └── columns.tsx           # 用户表格列定义
├── Items/                     # 项目/物品组件
│   ├── AddItem.tsx           # 添加项目
│   ├── EditItem.tsx          # 编辑项目
│   ├── DeleteItem.tsx        # 删除项目
│   ├── ItemActionsMenu.tsx   # 项目操作菜单
│   └── columns.tsx           # 项目表格列定义
├── Pending/                   # 待处理组件
│   ├── PendingItems.tsx      # 待处理项目
│   └── PendingUsers.tsx      # 待处理用户
├── UserSettings/              # 用户设置组件
│   ├── UserInformation.tsx   # 用户信息
│   ├── ChangePassword.tsx    # 修改密码
│   ├── DeleteAccount.tsx     # 删除账户
│   └── DeleteConfirmation.tsx # 删除确认
└── theme-provider.tsx         # 主题提供者
```

**组件分类**：
- **UI 组件**：基础 UI 组件（来自 shadcn/ui）
- **业务组件**：业务逻辑组件
- **布局组件**：页面布局组件
- **功能组件**：特定功能组件

##### `src/hooks/` - 自定义 Hooks

**作用**：自定义 React Hooks。

**文件说明**：
- `useAuth.ts`：认证相关 Hook（登录、注册、登出等）
- `useCustomToast.ts`：自定义 Toast 通知 Hook
- `useCopyToClipboard.ts`：复制到剪贴板 Hook
- `useMobile.ts`：移动端检测 Hook

**功能**：
- 封装可复用的逻辑
- 简化组件代码
- 提高代码复用性

##### `src/client/` - API 客户端

**作用**：自动生成的 API 客户端代码。

**文件说明**：
- `index.ts`：客户端入口
- `sdk.gen.ts`：API 方法（自动生成）
- `schemas.gen.ts`：数据模式（自动生成）
- `types.gen.ts`：TypeScript 类型（自动生成）
- `core/`：核心功能
  - `OpenAPI.ts`：OpenAPI 客户端配置
  - `request.ts`：HTTP 请求封装
  - `ApiError.ts`：API 错误类
  - `ApiResult.ts`：API 结果类型
  - `CancelablePromise.ts`：可取消的 Promise
  - `ApiRequestOptions.ts`：请求选项类型

**生成方式**：
- 从后端 OpenAPI 规范自动生成
- 使用 `@hey-api/openapi-ts` 工具
- 类型安全，与后端 API 完全同步

##### `src/i18n/` - 国际化

**作用**：前端国际化配置。

**文件说明**：
- `index.ts`：i18next 初始化配置
- `locales/`：翻译文件
  - `en_US/`：英文翻译
    - `auth.json`：认证相关翻译
    - `common.json`：通用翻译
    - `dashboard.json`：仪表板翻译
    - `items.json`：项目/物品翻译
    - `settings.json`：设置翻译
    - `users.json`：用户翻译
    - `validation.json`：验证消息翻译
  - `zh_CN/`：中文翻译（同上）

**功能**：
- 多语言支持
- 动态语言切换
- 与后端国际化配合

##### `src/lib/` - 工具库

**作用**：工具函数库。

**文件说明**：
- `utils.ts`：通用工具函数（如 `cn()` 用于合并 className）

##### `src/utils.ts` - 工具函数

**作用**：其他工具函数。

#### 2. `public/` - 静态资源

**作用**：静态资源文件。

**文件说明**：
- `assets/images/`：图片资源
  - `fastapi-icon.svg`：FastAPI 图标
  - `fastapi-logo.svg`：FastAPI Logo
  - `favicon.png`：网站图标

**特点**：
- 不会被 Vite 处理
- 直接复制到构建输出目录

#### 3. `tests/` - 测试文件

**作用**：前端端到端测试（使用 Playwright）。

**文件说明**：
- `auth.setup.ts`：认证测试设置
- `config.ts`：测试配置
- `login.spec.ts`：登录测试
- `sign-up.spec.ts`：注册测试
- `reset-password.spec.ts`：重置密码测试
- `user-settings.spec.ts`：用户设置测试
- `utils/`：测试工具
  - `mailcatcher.ts`：邮件测试工具
  - `privateApi.ts`：私有 API 测试工具
  - `random.ts`：随机数据生成
  - `user.ts`：用户测试工具

**测试框架**：
- **Playwright**：端到端测试框架
- **测试覆盖**：关键用户流程

#### 4. 配置文件

##### `package.json`

**作用**：前端项目配置和依赖管理。

**内容**：
- 项目元数据
- 依赖包列表
- 开发依赖
- 脚本命令（dev、build、test 等）

##### `tsconfig.json`

**作用**：TypeScript 编译配置。

**内容**：
- 编译选项
- 路径别名
- 类型定义

##### `vite.config.ts`

**作用**：Vite 构建工具配置。

**内容**：
- 构建选项
- 插件配置（React、TanStack Router、Tailwind CSS 等）
- 开发服务器配置
- 路径别名

##### `biome.json`

**作用**：Biome 代码检查和格式化配置。

**内容**：
- 代码检查规则
- 格式化规则
- 忽略文件配置

##### `components.json`

**作用**：shadcn/ui 组件配置。

**内容**：
- 组件路径配置
- 样式配置
- 别名配置

##### `playwright.config.ts`

**作用**：Playwright 测试配置。

**内容**：
- 浏览器配置
- 测试环境配置
- 测试文件路径

##### `openapi-ts.config.ts`

**作用**：OpenAPI TypeScript 生成配置。

**内容**：
- OpenAPI 规范文件路径
- 生成输出路径
- 生成选项

##### `nginx.conf`

**作用**：Nginx 生产环境配置。

**内容**：
- 静态文件服务
- 路由配置
- 反向代理配置

---

## 配置文件说明

### Docker 配置文件

#### `docker-compose.yml`

**作用**：定义所有服务（数据库、Redis、后端、前端等）。

**服务**：
- `db`：PostgreSQL 数据库
- `redis`：Redis 缓存和任务队列
- `backend`：FastAPI 后端服务
- `frontend`：React 前端服务
- `adminer`：数据库管理工具（可选）
- `prestart`：启动前初始化服务

#### `docker-compose.override.yml`

**作用**：开发环境的额外配置（覆盖默认配置）。

**用途**：
- 开发时的端口映射
- 开发时的卷挂载
- 开发时的环境变量

#### `docker-compose.traefik.yml`

**作用**：Traefik 反向代理配置。

**功能**：
- HTTPS 自动证书（Let's Encrypt）
- 域名路由
- 负载均衡

### 环境变量

#### `.env`

**作用**：本地开发环境变量（不提交到 Git）。

**内容**：
- 数据库连接信息
- Redis 连接信息
- JWT 密钥
- 邮件服务器配置
- 域名配置
- 其他敏感信息

#### `env.example`

**作用**：环境变量模板，供参考。

**用途**：
- 新开发者参考
- 部署时参考
- 文档说明

### Git 配置

#### `.gitignore`

**作用**：定义不提交到 Git 的文件。

**忽略内容**：
- 环境变量文件（`.env`）
- 构建输出（`dist/`、`build/`）
- 依赖目录（`node_modules/`、`.venv/`）
- IDE 配置
- 日志文件
- 临时文件

#### `.pre-commit-config.yaml`

**作用**：Pre-commit 钩子配置。

**功能**：
- 代码提交前自动检查
- 代码格式化
- 代码检查
- 测试运行

---

## 目录组织原则

### 1. 分层架构

**后端分层**：
```
路由层 (api/routes/) 
    ↓
服务层 (services/)
    ↓
CRUD 层 (crud/)
    ↓
模型层 (models/)
```

**前端分层**：
```
路由层 (routes/)
    ↓
组件层 (components/)
    ↓
Hooks 层 (hooks/)
    ↓
API 层 (client/)
```

### 2. 按功能模块组织

**后端**：
- 用户相关：`models/user.py`、`crud/user.py`、`services/user_service.py`、`api/routes/users.py`
- 项目相关：`models/item.py`、`crud/item.py`、`services/item_service.py`、`api/routes/items.py`

**前端**：
- 用户相关：`components/Admin/`、`components/UserSettings/`
- 项目相关：`components/Items/`

### 3. 关注点分离

- **配置**：集中在 `core/config.py`（后端）和配置文件（前端）
- **工具函数**：集中在 `utils/`（后端）和 `lib/`（前端）
- **异常处理**：集中在 `exceptions/`（后端）
- **中间件**：集中在 `middleware/`（后端）

### 4. 代码复用

- **通用组件**：放在 `components/Common/`（前端）
- **自定义 Hooks**：放在 `hooks/`（前端）
- **工具函数**：放在 `utils/`（后端）和 `lib/`（前端）

---

## 开发工作流

### 1. 添加新功能

**后端**：
1. 在 `models/` 中定义数据模型
2. 在 `crud/` 中添加数据库操作
3. 在 `services/` 中添加业务逻辑
4. 在 `api/routes/` 中添加 API 路由
5. 运行 Alembic 生成数据库迁移

**前端**：
1. 在 `components/` 中创建组件
2. 在 `routes/` 中添加路由
3. 在 `i18n/locales/` 中添加翻译
4. 使用自动生成的 API 客户端调用后端

### 2. 数据库变更

1. 修改 `models/` 中的模型
2. 运行 `alembic revision --autogenerate -m "描述"`
3. 检查生成的迁移脚本
4. 运行 `alembic upgrade head` 应用迁移

### 3. API 变更

1. 修改后端 API 路由
2. 运行后端，OpenAPI 规范自动更新
3. 运行前端 `npm run generate-client` 重新生成 API 客户端
4. 在前端使用新的 API 客户端

### 4. 国际化

**后端**：
1. 在代码中使用 `gettext()` 标记需要翻译的文本
2. 运行 `python scripts/compile_i18n.py` 提取翻译
3. 在 `locales/*/LC_MESSAGES/messages.po` 中添加翻译
4. 编译翻译文件

**前端**：
1. 在 `i18n/locales/*/` 中的 JSON 文件中添加翻译
2. 在组件中使用 `useTranslation()` Hook

### 5. 测试

**后端**：
1. 在 `tests/` 中编写测试
2. 运行 `pytest` 执行测试

**前端**：
1. 在 `tests/` 中编写 Playwright 测试
2. 运行 `npm run test` 执行测试

---

## 总结

### 架构特点

1. **前后端分离**：完全独立的代码库，可以独立开发和部署
2. **模块化设计**：代码按功能模块组织，便于维护
3. **分层架构**：清晰的层次结构，职责分明
4. **类型安全**：TypeScript（前端）和类型提示（后端）提供类型安全
5. **自动化**：API 客户端自动生成、数据库迁移自动生成

### 关键目录

- **后端入口**：`backend/app/main.py`
- **前端入口**：`frontend/src/main.tsx`
- **后端配置**：`backend/app/core/config.py`
- **前端配置**：`frontend/vite.config.ts`
- **数据库模型**：`backend/app/models/`
- **API 路由**：`backend/app/api/routes/`
- **React 组件**：`frontend/src/components/`
- **路由定义**：`frontend/src/routes/`

### 开发建议

1. **遵循目录结构**：不要随意创建新目录，遵循现有结构
2. **关注点分离**：每个文件只负责一个功能
3. **代码复用**：提取通用逻辑到工具函数或 Hooks
4. **类型安全**：充分利用类型系统
5. **测试覆盖**：为关键功能编写测试

---

## 参考

- [FastAPI 文档](https://fastapi.tiangolo.com)
- [React 文档](https://react.dev)
- [TanStack Router 文档](https://tanstack.com/router)
- [Vite 文档](https://vitejs.dev)
- [SQLModel 文档](https://sqlmodel.tiangolo.com)
